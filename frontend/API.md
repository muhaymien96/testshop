# API Reference (Frontend-focused)

This file lists the API endpoints the frontend calls and includes quick `curl` examples useful when writing integration tests or debugging.

Notes about cookies
- The server uses HttpOnly cookies for authentication (`auth_token`) and a separately managed `session_id` cookie for carts. To test API endpoints that require authentication, use a browser-based test runner (Playwright, Cypress), or create a session cookie using the backend test helper or by logging in via `/api/auth/login` and capturing the Set-Cookie header.

Base URL
- Default: http://localhost:3001/api
- Override by setting `NEXT_PUBLIC_API_URL` in frontend environment.

Endpoints

1) GET /api/products
- Description: List products with optional filters.
- Query params: category, search, minPrice, maxPrice, sortBy

Example:

curl -i "http://localhost:3001/api/products"

2) GET /api/products/:id
- Description: Get product detail

curl -i "http://localhost:3001/api/products/1"

3) GET /api/products/meta/categories
- Description: Get all categories

curl -i "http://localhost:3001/api/products/meta/categories"

4) POST /api/cart/add
- Description: Add item to cart for the current session. Server uses `session_id` cookie. Body: { productId, quantity }

curl -i -X POST "http://localhost:3001/api/cart/add" \
  -H "Content-Type: application/json" \
  --cookie "session_id=your_session_here" \
  -d '{"productId":1,"quantity":2}'

5) POST /api/cart/update
- Description: Update quantity

curl -i -X POST "http://localhost:3001/api/cart/update" \
  -H "Content-Type: application/json" \
  --cookie "session_id=your_session_here" \
  -d '{"productId":1,"quantity":3}'

6) GET /api/cart
- Description: Get cart for current session

curl -i "http://localhost:3001/api/cart" --cookie "session_id=your_session_here"

7) DELETE /api/cart
- Description: Clear cart

curl -i -X DELETE "http://localhost:3001/api/cart" --cookie "session_id=your_session_here"

8) POST /api/auth/login
- Description: Login, sets HttpOnly auth cookie on success. Body: { email, password }

curl -i -X POST "http://localhost:3001/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"email":"testuser@example.com","password":"password123"}'

Note: Capture `Set-Cookie` from response to use authenticated calls. Example (bash): `curl -c cookies.txt -X POST ...` and then `curl -b cookies.txt /api/checkout/my-orders`.

9) POST /api/auth/register
- Description: Register new account. Body: { name, email, password }

10) POST /api/auth/logout
- Description: Logout â€” clears auth cookie

11) POST /api/checkout
- Description: Process checkout. Body typically contains items, total, billing and paymentMethod. Requires authentication in typical flows; guest flows may be supported by session.

curl -i -X POST "http://localhost:3001/api/checkout" \
  -H "Content-Type: application/json" \
  --cookie "session_id=your_session_here; auth_token=..." \
  -d '{"items":[{"productId":1,"quantity":2,"price":9.99}],"total":19.98,"paymentMethod":"card","billing":{}}'

12) GET /api/checkout/my-orders
- Description: Get orders for the authenticated user

curl -i "http://localhost:3001/api/checkout/my-orders" --cookie "auth_token=..."

13) GET /api/checkout/orders/:orderId
- Description: Get order by ID

curl -i "http://localhost:3001/api/checkout/orders/123" --cookie "auth_token=..."

14) GET /api/admin/metrics
- Description: Get system metrics for test/debugging

curl -i "http://localhost:3001/api/admin/metrics"

15) GET /api/admin/docs
- Description: Returns machine-readable API docs (same as this file but generated by backend)

curl -i "http://localhost:3001/api/admin/docs"

16) GET /api/health
- Description: Health check

curl -i "http://localhost:3001/api/health"


Tips for tests
- Use a browser automation runner (Playwright/Cypress) that preserves cookies and can interact with the frontend UX.
- To write pure-API tests, authenticate by calling `/api/auth/login` and store the returned cookies; then use those cookies in subsequent `curl` or HTTP client requests.


If you'd like, I can also add a tiny Postman collection or a Playwright smoke test into this repo. Tell me which and I'll add it.